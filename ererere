resource "azapi_update_resource" "identity" {
  type        = "Microsoft.Compute/virtualMachines@2023-03-01"
  resource_id = azurerm_linux_virtual_machine.vm.id

  body = {
    identity = {
      type                   = length(var.managed_identity_ids) > 0 ? "UserAssigned" : "None"
      userAssignedIdentities = length(var.managed_identity_ids) > 0 ? { for id in var.managed_identity_ids : id => {} } : null
    }
  }
}
