resource "azapi_update_resource" "remove_identity" {
  type        = "Microsoft.Compute/virtualMachines@2023-03-01" # Ensure this API version is supported
  resource_id = "/subscriptions/${var.subscription_id}/resourceGroups/${var.resource_group}/providers/Microsoft.Compute/virtualMachines/${var.vm_name}"

  body = {
    identity = null
  }
}


az provider show --namespace Microsoft.Compute --query "resourceTypes[?resourceType=='virtualMachines'].apiVersions"


az resource show --ids "/subscriptions/d81199c9-db9f-4fd1-bef6-b3a84fd3f306/resourceGroups/c750f6ca-a6c3-4d12-a052-aeab0c060186/providers/Microsoft.Compute/virtualMachines/<vm_name>"


resource "azapi_update_resource" "remove_identity" {
  type        = "Microsoft.Compute/virtualMachines@2023-03-01" # Use a verified API version
  resource_id = "/subscriptions/${var.subscription_id}/resourceGroups/${var.resource_group}/providers/Microsoft.Compute/virtualMachines/${var.vm_name}"

  body = {
    identity = null # or { type = "None" } depending on API requirements
  }
}
